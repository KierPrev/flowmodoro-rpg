<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Flowmodoro RPG ‚Äî Web</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" type="image/png" href="flowmodoro-rpg.png" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <main class="container">
    <header class="topbar">
      <h1 class="title">Flowmodoro RPG</h1>
      <button id="btnSettings" class="btn ghost" title="Configuraci√≥n" aria-label="Configuraci√≥n">‚öôÔ∏è</button>
    </header>

    <section class="zen">
      <!-- Balance System Redesign - No large timer, only balance components -->


      <section class="group boss-group">
        <div class="group-title">Jefe</div>
        <div class="group-body">
          <div id="bossName" class="boss-name">üêâ ‚Äî ‚Ä¶</div>

          <div class="row hp-row">
            <!-- Barra HP -->
            <div class="progress boss" id="bossHp" role="progressbar" aria-label="HP del jefe" aria-valuemin="0"
              aria-valuemax="100" aria-valuenow="0">
              <div class="chunk shimmer" id="bossHpChunk"></div>
              <canvas id="bossOverlay" class="overlay" aria-hidden="true"></canvas>
              <div id="hpInfo" class="hp-info"></div>
            </div>
          </div>
        </div>
      </section>

      <section class="group">
        <div class="group-title">Experiencia ‚ú®</div>
        <div class="group-body">
          <div class="row">
            <div class="subtitle"></div>
            <div class="progress exp" id="expBar" role="progressbar" aria-label="EXP" aria-valuemin="0"
              aria-valuemax="100" aria-valuenow="0">
              <div class="chunk" id="expChunk"></div>
              <div id="expInfo" class="exp-info"></div>
            </div>
          </div>
        </div>
      </section>

      <div class="balance-display">
        <div class="balance-components">
          <span id="focusLabel" class="balance-component">Enfoque: 00:00</span>
          <span class="balance-separator">|</span>
          <span id="breakLabel" class="balance-component">Descanso: 00:00</span>
        </div>
        <div class="balance-components">
          <span id="ratioProductivoLabel" class="balance-component">Neto: 00:00</span>
        </div>
        <div id="balanceFeedback" class="balance-feedback"></div>
        <div class="row controls">
          <button id="btnForget" class="btn danger" title="üèÅ Rendirse: Terminar sesi√≥n y reiniciar tiempos"
            aria-label="Rendirse y reiniciar tiempos">üèÅ</button>
          <button id="btnAlarm" class="btn" title="‚è∞ Configurar alarma" aria-label="Configurar alarma">‚è∞</button>
        </div>

        <!-- Alarm Popover -->
        <div id="alarmPopover" class="alarm-popover">
          <div class="alarm-popover-content">
            <div class="alarm-title">‚è∞ Configurar Alarma</div>
            <div class="alarm-options">
              <button class="alarm-preset" data-minutes="5">5 min</button>
              <button class="alarm-preset" data-minutes="10">10 min</button>
              <button class="alarm-preset" data-minutes="25">25 min</button>
            </div>
            <div class="alarm-custom">
              <label for="alarmSlider">Personalizado:</label>
              <input type="range" id="alarmSlider" min="1" max="60" value="5" step="1">
              <span id="alarmValue">5 min</span>
            </div>
            <div class="alarm-actions">
              <button id="alarmSet" class="btn primary">Establecer</button>
              <button id="alarmCancel" class="btn">Cancelar</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Indicador de progreso de sesi√≥n con fases m√∫ltiples -->
      <div class="session-progress">
        <div class="session-progress-bar">
          <div id="sessionProgressFill" class="session-progress-fill"></div>
        </div>
      </div>

    </section>

    <div class="bottom-buttons">
      <button id="btnZenMode" class="btn ghost" title="Z: Activar modo Zen para enfoque"
        aria-label="Activar modo Zen (Z)">Zen</button>
      <button id="btnMore" class="btn ghost">M√°s‚Ä¶</button>
    </div>


    <section id="moreArea" class="more">
      <!-- Estad√≠sticas -->
      <section class="group">
        <div class="group-title">üìä Estad√≠sticas</div>
        <div class="group-body">
          <div class="stats-grid">
            <div class="stat-item">
              <div class="stat-label">Sesiones hoy</div>
              <div class="stat-value" id="statsSessionsToday">0</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">Tiempo promedio</div>
              <div class="stat-value" id="statsAvgSession">00:00</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">Mejor racha</div>
              <div class="stat-value" id="statsBestStreak">0</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">Tiempo semanal</div>
              <div class="stat-value" id="statsWeeklyTime">00:00</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Logros -->
      <section class="group">
        <div class="group-title">üèÜ Logros</div>
        <div class="group-body">
          <div id="achievementsList" class="achievements-list">
            <!-- Los logros se cargar√°n din√°micamente -->
          </div>
        </div>
      </section>

      <!-- Gemas (sin t√≠tulo, minimalista) -->
      <section class="group tokens-group">
        <div class="group-title sr-only">Recompensas (Gemas)</div>
        <div class="group-body row wrap gap">
          <div id="tokensLabel" class="subtitle">Gemas: 0</div>
          <button id="btnTokenSmall" class="btn primary">üß∞ Cofre chico (‚àí1)</button>
          <button id="btnTokenBig" class="btn primary">üèÜ Cofre grande (‚àí3)</button>
        </div>
      </section>

      <!-- Acciones + dificultad inline -->
      <section class="group">
        <div class="group-title sr-only">Acciones</div>
        <div class="group-body row wrap gap">
          <button id="btnNewBoss" class="btn">Nuevo jefe üê≤</button>
          <span class="inline-label">Dificultad:</span>
          <button id="btnDiff" class="btn">Normal 1:3</button>
          <div class="sep"></div>
          <button id="btnReset" class="btn danger">Reset</button>
        </div>
      </section>

      <!-- Cr√≥nicas -->
      <section class="group story-group">
        <div class="group-title">Cr√≥nicas del estudio üìñ</div>
        <div class="group-body">
          <div id="storyText" class="story">Tu historia se escribir√° aqu√≠ al subir de nivel.</div>
        </div>
      </section>
    </section>

    <!-- Di√°logo nivel -->
    <dialog id="dlgLevel">
      <div class="dialog-body">
        <div class="dialog-title">üéâ ¬°Subiste de nivel!</div>
        <p id="dlgLevelText">Alcanzaste el nivel X.</p>
        <div class="dialog-actions">
          <button id="dlgLevelOk" class="btn primary">OK</button>
        </div>
      </div>
    </dialog>

    <!-- Onboarding -->
    <dialog id="dlgTips">
      <div class="dialog-body">
        <div class="dialog-title">Consejos iniciales</div>
        <ul>
          <li><b>Enfoque</b>: Inicia el cron√≥metro y manten√© la concentraci√≥n.</li>
          <li><b>Descanso</b>: Cambi√° de modo para pausas saludables.</li>
          <li><b>Jefe</b>: Cada sesi√≥n suma da√±o y EXP para derrotarlo.</li>
          <li><b>Gemas</b>: Ganalas con EXP y √∫salas en cofres.</li>
          <li><b>M√°s‚Ä¶</b>: Progreso, dificultad y tu cr√≥nica.</li>
        </ul>
        <div class="dialog-actions">
          <button id="dlgTipsOk" class="btn primary">Entendido</button>
        </div>
      </div>
    </dialog>

    <!-- Settings Dialog -->
    <dialog id="dlgSettings">
      <div class="dialog-body">
        <div class="dialog-title">‚öôÔ∏è Configuraci√≥n</div>
        <div class="sound-settings">
          <label class="sound-toggle">
            <input type="checkbox" id="soundMaster" checked>
            <span class="toggle-slider"></span>
            <span class="toggle-label">Sonido general</span>
          </label>
          <label class="sound-toggle">
            <input type="checkbox" id="soundNotifications" checked>
            <span class="toggle-slider"></span>
            <span class="toggle-label">Notificaciones</span>
          </label>
          <label class="sound-toggle">
            <input type="checkbox" id="soundButtons" checked>
            <span class="toggle-slider"></span>
            <span class="toggle-label">Botones</span>
          </label>
        </div>
        <div class="theme-settings">
          <label class="sound-toggle">
            <input type="checkbox" id="autoDarkMode" checked>
            <span class="toggle-slider"></span>
            <span class="toggle-label">Modo oscuro autom√°tico (8 PM - 6 AM)</span>
          </label>
        </div>
        <div class="dialog-actions">
          <button id="dlgSettingsOk" class="btn primary">Cerrar</button>
        </div>
      </div>
    </dialog>

  </main>

  <script type="module" src="app.js"></script>
  <script type="module" src="particles.js"></script>
</body>

</html>